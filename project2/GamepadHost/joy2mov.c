#include "joy2mov.h"

// map joystick values to VELOCITY
// generated from python script
const int16_t VELOCITY_TABLE[256] = { 
+200, +200, +200, +200, +200, +200, +199, +199, +199, +199, +198, +198, +197, +197, +197, +196, 
+195, +195, +194, +194, +193, +192, +192, +191, +190, +189, +188, +187, +187, +186, +185, +184, 
+183, +182, +181, +179, +178, +177, +176, +175, +174, +172, +171, +170, +168, +167, +166, +164, 
+163, +161, +160, +158, +157, +155, +154, +152, +151, +149, +147, +146, +144, +142, +141, +139, 
+137, +135, +133, +132, +130, +128, +126, +124, +122, +120, +118, +117, +115, +113, +111, +109, 
+107, +105, +103, +100, +98, +96, +94, +92, +90, +88, +86, +84, +81, +79, +77, +75, 
+73, +70, +68, +66, +64, +61, +59, +57, +55, +52, +50, +48, +46, +43, +41, +39, 
+36, +34, +32, +29, +27, +25, +22,  +0,  +0,  +0,  +0,  +0,  +0,  +0,  +0,  +0, 
 +0,  +0,  +0,  +0,  +0,  +0,  +0,  +0,  +0,  +0, -25, -27, -29, -32, -34, -36, 
-39, -41, -43, -46, -48, -50, -52, -55, -57, -59, -61, -64, -66, -68, -70, -73, 
-75, -77, -79, -81, -84, -86, -88, -90, -92, -94, -96, -98, -100, -103, -105, -107, 
-109, -111, -113, -115, -117, -118, -120, -122, -124, -126, -128, -130, -132, -133, -135, -137, 
-139, -141, -142, -144, -146, -147, -149, -151, -152, -154, -155, -157, -158, -160, -161, -163, 
-164, -166, -167, -168, -170, -171, -172, -174, -175, -176, -177, -178, -179, -181, -182, -183, 
-184, -185, -186, -187, -187, -188, -189, -190, -191, -192, -192, -193, -194, -194, -195, -195, 
-196, -197, -197, -197, -198, -198, -199, -199, -199, -199, -200, -200, -200, -200, -200, -200 };

    
// map joystick values to TURN RADIUS
// generated from python script
const int16_t RADIUS_TABLE[256] = { 
   +1,    +1,    +1,    +1,    +1,    +2,    +3,    +4,    +6,    +7,    +9,   +11,   +13,   +15,   +17,   +19, 
  +22,   +24,   +27,   +30,   +33,   +36,   +40,   +43,   +47,   +50,   +54,   +58,   +62,   +66,   +71,   +75, 
  +79,   +84,   +88,   +93,   +98,  +103,  +108,  +112,  +118,  +123,  +128,  +133,  +138,  +144,  +149,  +155, 
 +160,  +166,  +171,  +177,  +183,  +189,  +194,  +200,  +206,  +212,  +218,  +223,  +229,  +235,  +241,  +247, 
 +253,  +259,  +265,  +271,  +277,  +282,  +288,  +294,  +300,  +306,  +311,  +317,  +323,  +329,  +334,  +340, 
 +345,  +351,  +356,  +362,  +367,  +372,  +377,  +382,  +388,  +392,  +397,  +402,  +407,  +412,  +416,  +421, 
 +425,  +429,  +434,  +438,  +442,  +446,  +450,  +453,  +457,  +460,  +464,  +467,  +470,  +473,  +476,  +478, 
 +481,  +483,  +485,  +487,  +489,  +491,  +493, +32768, +32768, +32768, +32768, +32768, +32768, +32768, +32768, +32768, 
+32768, +32768, +32768, +32768, +32768, +32768, +32768, +32768, +32768, +32768,  -493,  -491,  -489,  -487,  -485,  -483, 
 -481,  -478,  -476,  -473,  -470,  -467,  -464,  -460,  -457,  -453,  -450,  -446,  -442,  -438,  -434,  -429, 
 -425,  -421,  -416,  -412,  -407,  -402,  -397,  -392,  -388,  -382,  -377,  -372,  -367,  -362,  -356,  -351, 
 -345,  -340,  -334,  -329,  -323,  -317,  -311,  -306,  -300,  -294,  -288,  -282,  -277,  -271,  -265,  -259, 
 -253,  -247,  -241,  -235,  -229,  -223,  -218,  -212,  -206,  -200,  -194,  -189,  -183,  -177,  -171,  -166, 
 -160,  -155,  -149,  -144,  -138,  -133,  -128,  -123,  -118,  -112,  -108,  -103,   -98,   -93,   -88,   -84, 
  -79,   -75,   -71,   -66,   -62,   -58,   -54,   -50,   -47,   -43,   -40,   -36,   -33,   -30,   -27,   -24, 
  -22,   -19,   -17,   -15,   -13,   -11,    -9,    -7,    -6,    -4,    -3,    -1,    -1,    -1,    -1,    -1 };
    
    
void joystick_to_movement(uint8_t x, uint8_t y, int16_t* velocity, int16_t* radius)
{
    // use a running average to smooth between sudden changes in joystick position
    static uint8_t prev_x = 128;
    static uint8_t prev_y = 128;
    
    // get values from lookup rable
    *velocity = VELOCITY_TABLE[(y + prev_y)/2];
    *radius = RADIUS_TABLE[(x + prev_x)/2];
}

